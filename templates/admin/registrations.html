{% extends "base.html" %}

{% block title %}挂号受理{% endblock %}

{% block content %}
<div class="card">
    <h2 class="card-title">挂号受理</h2>
    
    <h3>未受理挂号</h3>
    {% if registrations %}
    <table>
        <thead>
            <tr>
                <th>挂号编号</th>
                <th>病历号</th>
                <th>科室编号</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for reg in registrations %}
            <tr>
                <td>{{ reg.registration_id }}</td>
                <td>{{ reg.patient_id }}</td>
                <td>{{ reg.department_id }}</td>
                <td>{{ reg.created_at }}</td>
                <td>
                    <form method="POST" style="display: inline;">
                        <input type="hidden" name="registration_id" value="{{ reg.registration_id }}">
                        <select name="doctor_id" class="form-control" style="display: inline; width: auto;" required>
                            {% for doc in doctors %}
                            <option value="{{ doc.doctor_id }}">{{ doc.name }} ({{ doc.doctor_id }})</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-success">受理</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>暂无未受理挂号</p>
    {% endif %}
    
    <h3 style="margin-top: 2rem;">可用医生列表</h3>
    {% if doctors %}
    <table>
        <thead>
            <tr>
                <th>工号</th>
                <th>姓名</th>
                <th>科室编号</th>
                <th>职称</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in doctors %}
            <tr>
                <td>{{ doc.doctor_id }}</td>
                <td>{{ doc.name }}</td>
                <td>{{ doc.department_id or '未分配' }}</td>
                <td>{{ doc.position or '未设置' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    
    <div style="margin-top: 2rem;">
        <a href="{{ url_for('admin_home') }}" class="btn btn-secondary">返回</a>
    </div>
</div>
{% endblock %}
